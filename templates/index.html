<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>ğŸ“¡ 6ì‚¬ë³´ë„ ì„œë¹„ìŠ¤ ë‚´ì—­</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "",
      authDomain: "sabodo-82fa8.firebaseapp.com",
      projectId: "sabodo-82fa8",
      storageBucket: "sabodo-82fa8.firebasestorage.app",
      messagingSenderId: "411843694800",
      appId: "1:411843694800:web:94e40d6ec9f05cdd60ced5",
      measurementId: "G-CKBERJMFMG"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tableRef = db.collection("logTable");
    const alarmRef = db.collection("system").doc("alarmStatus"); // Firestoreì—ì„œ ì•ŒëŒ ìƒíƒœë¥¼ ê´€ë¦¬

	let isShowingAll = false; // false = ê¸°ë³¸ ë³´ê¸°
	let isAlarmActive = false; // ê¸°ë³¸ê°’: ì •ì§€ ìƒíƒœ


    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í•¨ìˆ˜
function checkLogin() {
  const currentUser = localStorage.getItem("username");

  if (currentUser) {
    document.getElementById("login-container").style.display = "none";
    document.getElementById("service-container").style.display = "block";
    document.getElementById("currentUser").innerText = `${currentUser} ë‹˜`;

	const senderSelect = document.getElementById("inputSender");
	    if (senderSelect) {
	      // SBS_NQC, SBS_ING ê³„ì •ë„ SBSë¡œ ê°„ì£¼í•˜ì—¬ ê¸°ë³¸ê°’ ì„¤ì •
	      let defaultSender = currentUser;
	      if (["SBS_NQC", "SBS_ING"].includes(currentUser)) {
	        defaultSender = "SBS";
	      }
	      senderSelect.value = defaultSender.toUpperCase();
	    }
    loadTable();
    listenToAlarmStatus();


    // âœ… ê³„ì •ë³„ ê¶Œí•œ ì„¤ì • (í™•ì¥ ê°€ëŠ¥)
	const userPermissions = {
	  SBS_ADMIN: { backup: true, alarm: true, excel: true, canRegister: true, canDelete: true },
	  SBS: { backup: false, alarm: true, excel: true, canRegister: false, canDelete: false },
	  SBS_NQC: { backup: false, alarm: true, excel: true, canRegister: false, canDelete: false },
	  SBS_ING: { backup: false, alarm: true, excel: true, canRegister: false, canDelete: false },
	  KBS: { backup: false, alarm: true, excel: true, canRegister: true, canDelete: true },
	  MBC: { backup: false, alarm: true, excel: true, canRegister: true, canDelete: true },
	  YTN: { backup: false, alarm: true, excel: true, canRegister: true, canDelete: true },
	  "LGU+": { backup: true, alarm: true, excel: true, canRegister: true, canDelete: true },
	  OBS: { backup: false, alarm: true, excel: true, canRegister: true, canDelete: true }
	};

	let normalizedUser = currentUser;
	if (["SBS_NQC", "SBS_ING"].includes(currentUser)) {
	  normalizedUser = "SBS";
	}
	
	const permissions = userPermissions[currentUser] || userPermissions[normalizedUser] || { canRegister: true, canDelete: true };


    // ë‚´ìš© ë“±ë¡ ë²„íŠ¼ ì œì–´
    const registerBtn = document.querySelector("button[onclick='openContentPopup()']");
    if (registerBtn) {
      registerBtn.disabled = !permissions.canRegister;
      registerBtn.style.opacity = permissions.canRegister ? "1" : "0.5";
      registerBtn.style.cursor = permissions.canRegister ? "pointer" : "not-allowed";
      registerBtn.title = permissions.canRegister ? "" : "ì´ ê³„ì •ì€ ë‚´ìš© ë“±ë¡ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.";
    }

    // í–‰ ì‚­ì œ ë²„íŠ¼ ì œì–´ (table ë‚´ ê° í–‰ì˜ ì‚­ì œ ë²„íŠ¼ë„ ë¹„í™œì„±í™” ì²˜ë¦¬)
    // í–‰ ì‚­ì œ ë²„íŠ¼ì€ loadTable()ì—ì„œ ë§¤ë²ˆ ìƒì„±í•˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ì „ì²´ í…Œì´ë¸” í–‰ ì‚­ì œ ë²„íŠ¼ì„ ì œì–´í•˜ëŠ” ë²„íŠ¼ì´ ë”°ë¡œ ìˆë‹¤ë©´ ì œì–´í•´ì£¼ê³ ,
    // ì•„ë‹ˆë©´ loadTable()ì—ì„œ ê¶Œí•œ ì²´í¬ í›„ disabled ì²˜ë¦¬í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.
    // ì˜ˆì‹œë¡œ id="deleteRowButton"ê°€ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬ ê°€ëŠ¥:
    
    const deleteRowBtn = document.getElementById("deleteRowButton");
    if (deleteRowBtn) {
      deleteRowBtn.disabled = !permissions.canDelete;
      deleteRowBtn.style.opacity = permissions.canDelete ? "1" : "0.5";
      deleteRowBtn.style.cursor = permissions.canDelete ? "pointer" : "not-allowed";
      deleteRowBtn.title = permissions.canDelete ? "" : "ì´ ê³„ì •ì€ í–‰ ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.";
    }
   
	  
    // âœ… ìë£Œì†¡ì¶œ ë‚´ì—­ ë°±ì—… ë²„íŠ¼ ì œì–´
    const backupBtn = document.getElementById("backupButton");
    if (backupBtn && permissions.backup === false) {
      backupBtn.disabled = true;
      backupBtn.style.backgroundColor = "#ccc";
      backupBtn.style.cursor = "not-allowed";
      backupBtn.title = "ì´ ê³„ì •ì€ ë°±ì—… ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.";
    }

    // âœ… ì—‘ì…€ ì €ì¥ ë²„íŠ¼ ì œì–´
    const excelBtn = document.querySelector("button[onclick='downloadAsExcel()']");
    if (excelBtn && permissions.excel === false) {
      excelBtn.disabled = true;
      excelBtn.style.backgroundColor = "#ccc";
      excelBtn.style.cursor = "not-allowed";
      excelBtn.title = "ì´ ê³„ì •ì€ ì—‘ì…€ ì €ì¥ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.";
    }

    // âœ… ì•ŒëŒ ì „ì†¡ ë²„íŠ¼ ì œì–´
    const alarmBtn = document.getElementById("alarmToggleButton");
    if (alarmBtn && permissions.alarm === false) {
      alarmBtn.disabled = true;
      alarmBtn.style.backgroundColor = "#ccc";
      alarmBtn.style.cursor = "not-allowed";
      alarmBtn.title = "ì´ ê³„ì •ì€ ì•ŒëŒ ì „ì†¡ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.";
    }

  } else {
    document.getElementById("login-container").style.display = "block";
    document.getElementById("service-container").style.display = "none";
  }
}

function triggerPopupForAllUsers() {
  alarmRef.set({
    isAlarmActive: true,
    alarmMessage: "ğŸ“¡ 6ì‚¬ë³´ë„ ìë£Œì†¡ì¶œì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!",
    timestamp: Date.now()
  });
}


function deleteAllhides() {
  tableRef
    .orderBy("createdAt", "desc")
    .get()
    .then(snapshot => {
      const docs = snapshot.docs;

      const hidePromises = [];
      for (let i = 0; i < docs.length; i++) {
        const data = docs[i].data();
        
        // ê³ ì • í–‰ ë‚´ìš©ê³¼ ê°™ì€ ê²½ìš° ì œì™¸
        if (data.content === "ğŸ›  ë‚´ìš© ë“±ë¡ ë°•ìŠ¤ë¥¼ ì…ë ¥í•˜ì‹œê³  ë“±ë¡ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.(ì²« í–‰ì€ ê³ ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.)") {
          continue; // ê³ ì • í–‰ì€ ìˆ¨ê¸°ì§€ ì•ŠìŒ
        }

        hidePromises.push(docs[i].ref.update({ hidden: true }));
      }

      Promise.all(hidePromises).then(() => {
        loadTable();
        alert("ëª¨ë“  í–‰ì„ ìˆ¨ê²¼ìŠµë‹ˆë‹¤ (ê³ ì • í–‰ì€ ìœ ì§€ë©ë‹ˆë‹¤).");
      });
    });
}

let audioCtx;
let oscillator;
let gainNode;
let alarmInterval;

function initializeAudioContext() {
  if (!audioCtx || audioCtx.state === 'closed') {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}


// ğŸ”” ì•ŒëŒ ë²„íŠ¼ í´ë¦­ ì‹œ ì „ì²´ ì•Œë¦¼ í™œì„±í™” (ëª¨ë“  ê³„ì •ì— ì ìš©)
function toggleAlarm() {
  const username = localStorage.getItem("username");
  if (!username) return;

  localStorage.removeItem(`alarmAcknowledged_${username}`); // ì•Œë¦¼ ì´ˆê¸°í™”
  sendAlarm(); // Firestoreì˜ ì „ì²´ ì•ŒëŒ ìƒíƒœë¥¼ trueë¡œ ì„¤ì •
  alert("ğŸ“¢ ì „ì²´ ì‚¬ìš©ìì—ê²Œ ìë£Œì†¡ì¶œ ì•Œë¦¼ì„ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.");
}

function playSoftTone() {
  if (!audioCtx) return;

  oscillator = audioCtx.createOscillator();
  gainNode = audioCtx.createGain();

  oscillator.type = 'sine';
  oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // ë¶€ë“œëŸ¬ìš´ AìŒ

  gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime); // ë³¼ë¥¨ ì„¤ì •

  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);

  oscillator.start();
  oscillator.stop(audioCtx.currentTime + 1.0); // 1ì´ˆ ì¬ìƒ
}

function playLoopingBeep() {
  stopLoopingBeep(); // ì¤‘ë³µ ë°©ì§€
  alarmInterval = setInterval(playSoftTone, 1500); // 1.5ì´ˆ ê°„ê²© ë°˜ë³µ
}

function stopLoopingBeep() {
  clearInterval(alarmInterval);
  if (oscillator) {
    try { oscillator.stop(); } catch (e) {}
    oscillator.disconnect();
  }
  if (gainNode) gainNode.disconnect();
}

// ì—¬ëŸ¬ íŒì—… ìƒì„± í•¨ìˆ˜
function createAlarmPopup(message, popupId, docId) {
  const container = document.getElementById("alarmPopupContainer");

  const popup = document.createElement("div");
  popup.id = popupId;
  popup.style.background = "white";
  popup.style.padding = "20px";
  popup.style.borderRadius = "12px";
  popup.style.boxShadow = "0 0 12px rgba(0,0,0,0.3)";
  popup.style.marginBottom = "10px";
  popup.style.textAlign = "center";

  popup.innerHTML = `
    <p class="alarm-text" style="font-size: 18px; font-weight: bold;">${message.replace(/\n/g, "<br>")}</p>
    <p>í™•ì¸ì„ ëˆ„ë¥´ë©´ ì´ ê³„ì •ì—ì„œë§Œ ì•Œë¦¼ì´ ì •ì§€ë©ë‹ˆë‹¤.</p>
    <button style="margin-top: 20px; padding: 10px 20px; font-size: 16px;" onclick="acknowledgeSingleAlarm('${popupId}', '${docId}')">âœ… í™•ì¸</button>
  `;

  container.appendChild(popup);
}

// ê°œë³„ íŒì—… ë‹«ê¸° í•¨ìˆ˜
function acknowledgeSingleAlarm(popupId, docId) {
  // 1. íŒì—… ë‹«ê¸°
  const popup = document.getElementById(popupId);
  if (popup) popup.remove();

  // 2. ë¡œê·¸ì¸ ì‚¬ìš©ì í™•ì¸
  const username = localStorage.getItem("username");
  if (!username) {
    console.warn("ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ì–´ ì•Œë¦¼ í™•ì¸ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // 3. SBS_NQC ê³„ì •ì€ í™•ì¸ ìƒíƒœ ê°±ì‹ í•˜ì§€ ì•ŠìŒ
  if (username === "SBS_NQC") {
    console.log("SBS_NQC ê³„ì •ì€ ack ìƒíƒœë¥¼ ê°±ì‹ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    stopLoopingBeep();
    if (audioCtx && audioCtx.state === "suspended") {
      audioCtx.resume();
    }
    return;
  }

  // 4. ë¬¸ì„œ ID ìœ íš¨ì„± í™•ì¸
  if (!docId) {
    console.warn("ë¬¸ì„œ IDê°€ ì—†ì–´ í™•ì¸ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // 5. ê³„ì •ëª…ì„ ìˆ˜ì‹ ì‚¬ ì´ë¦„ìœ¼ë¡œ ì •ê·œí™”
  const normalizedUser = ["SBS_ING"].includes(username) ? "SBS" : username.toUpperCase();

  // 6. í•´ë‹¹ ìˆ˜ì‹ ì‚¬ì˜ ack ìƒíƒœë§Œ 'í™•ì¸ì™„ë£Œ'ë¡œ ê°±ì‹ 
  const updateData = {};
  updateData[`${normalizedUser}.ack`] = "í™•ì¸ì™„ë£Œ";

  tableRef.doc(docId).update(updateData)
    .then(() => {
      loadTable(); // UI ê°±ì‹ 
    })
    .catch(err => {
      console.error("ack ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", err);
    });

  // 7. ì•ŒëŒìŒ ì •ì§€ ë° ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì¬ê°œ
  stopLoopingBeep();
  if (audioCtx && audioCtx.state === "suspended") {
    audioCtx.resume();
  }
}
	  

function listenToAlarmStatus() {
  alarmRef.onSnapshot(doc => {
    const alarmStatus = doc.data();
    const username = localStorage.getItem("username");
    if (!alarmStatus || !username) return;

    const acknowledgedKey = `alarmAcknowledged_${username}`;
    const acknowledgedAt = parseInt(localStorage.getItem(acknowledgedKey) || "0", 10);
    const now = Date.now();
    const alarmStart = alarmStatus.timestamp || now;

    // ì•„ì§ í™•ì¸í•˜ì§€ ì•Šì•˜ê³  5ë¶„ ì´ë‚´ë©´ ì•ŒëŒ í‘œì‹œ
    if (alarmStatus.isAlarmActive && (!acknowledgedAt || acknowledgedAt < alarmStart)) {
        initializeAudioContext();
        playLoopingBeep();
        showAlarmPopup(alarmStatus.alarmMessage || "ğŸ“¡ ìë£Œ ì†¡ì¶œ ì•Œë¦¼ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤!");
    } else {
      // hideAlarmPopup();
      stopLoopingBeep();
    }
  });
}


function toggleBroadcastStatus(button) {
  const tr = button.closest("tr");
  const rowId = tr.getAttribute("data-row-id");
  const current = button.innerText;

  let nextState, color;
  if (current === "ì†¡ì¶œì „") {
    nextState = "ì†¡ì¶œì¤‘";
    color = "#ffcccc";  // ì—°ë¹¨ê°•
  } else if (current === "ì†¡ì¶œì¤‘") {
    nextState = "ì†¡ì¶œí›„";
    color = "#dcdcdc";  // íšŒìƒ‰
  } else {
    nextState = "ì†¡ì¶œì „";
    color = "#fffbe6";  // ì—°ë…¸ë‘
  }

  // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° í–‰ ìƒ‰ìƒ ë³€ê²½
  button.innerText = nextState;
  tr.style.backgroundColor = color;

  // Firestoreì— ìƒíƒœ ì—…ë°ì´íŠ¸
  if (rowId) {
    tableRef.doc(rowId).update({
      broadcastStatus: nextState
    });
  }
}


	  
function deleteAllRows() {
  if (!confirm("ì •ë§ ëª¨ë“  í–‰ì„ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;

  tableRef.get().then(snapshot => {
    const deletePromises = [];
    snapshot.forEach(doc => {
      const data = doc.data();

      // âœ… ê³ ì •í–‰ì€ ì‚­ì œí•˜ì§€ ì•ŠìŒ
      if (data.content === "ğŸ›  ë‚´ìš© ë“±ë¡ ë°•ìŠ¤ë¥¼ ì…ë ¥í•˜ì‹œê³  ë“±ë¡ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.(ì²« í–‰ì€ ê³ ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.)") {
        return; // ì‚­ì œ ì œì™¸
      }

      deletePromises.push(doc.ref.delete());
    });

    return Promise.all(deletePromises);
  }).then(() => {
    alert("ëª¨ë“  í–‰ì´ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤ (ê³ ì • í–‰ ì œì™¸).");
    loadTable();
  }).catch(error => {
    console.error("ì‚­ì œ ì˜¤ë¥˜:", error);
    alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  });
}



  // ê±´ìˆ˜ ë³´ê¸° í•¨ìˆ˜
  function openAllView() {
    window.open("allview.html", "_blank", "width=1200,height=800");
  }

// ì „ì²´ ë³´ê¸° í•¨ìˆ˜
function openAllRows() {
    // hidden ì—¬ë¶€ì— ê´€ê³„ì—†ì´ ì „ì²´ ë¡œìš° ë³´ì—¬ì£¼ê¸°
    tableRef
      .orderBy('createdAt', 'desc')
      .get()
      .then(snapshot => {
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";
        const docs = snapshot.docs;
        const total = docs.length;

        docs.forEach((doc, index) => {
          const data = doc.data();
          const rowId = doc.id;
          const tr = document.createElement("tr");
          tr.setAttribute("data-row-id", rowId);
          tr.innerHTML = `
            <td>${total - index}</td>
            <td>${data.date || ''}</td>
            <td>${data.time || ''}</td>
            <td>${data.content || ''}</td>
            <td>${data.sender || ''}</td>
            <td colspan="6">ìˆ¨ê¹€ ì—¬ë¶€: ${data.hidden ? 'âœ… ìˆ¨ê¹€' : 'âŒ í‘œì‹œì¤‘'}</td>
	    <td>
	    <button onclick="deleteRowById('${doc.id}')">í–‰ ì‚­ì œ</button>
	    </td>
          `;
          tbody.appendChild(tr);
        });
      });

  }

function downloadAsExcel() {
  const table = document.getElementById("logTable");
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.table_to_sheet(table);
  XLSX.utils.book_append_sheet(wb, ws, "6ì‚¬ë³´ë„ë§");

  // âœ… ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸° (YYYY-MM-DD í˜•ì‹)
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth() + 1).padStart(2, '0');
  const dd = String(now.getDate()).padStart(2, '0');
  const todayStr = `${yyyy}-${mm}-${dd}`;

  // âœ… íŒŒì¼ëª…ì— ë‚ ì§œ ì¶”ê°€
  XLSX.writeFile(wb, `6ì‚¬ë³´ë„ë§_ì„œë¹„ìŠ¤ë‚´ì—­_${todayStr}.xlsx`);
}


    // ë¡œê·¸ì¸ í•¨ìˆ˜
function login() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value;

  fetch("static/users.json")  // âœ… users.json ê²½ë¡œ ì£¼ì˜!
    .then(response => {
      if (!response.ok) throw new Error("ê³„ì • ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      return response.json();
    })
    .then(users => {
      const user = users[username];

      if (!user) {
        document.getElementById("error-message").innerText = "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤.";
        return;
      }

      if (user.password !== password) {
        document.getElementById("error-message").innerText = "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.";
        return;
      }

      if (!user.enabled) {
        document.getElementById("error-message").innerText = "ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤.";
        return;
      }

      // âœ… ë¡œê·¸ì¸ ì„±ê³µ
      localStorage.setItem("username", username);
      localStorage.setItem("userRole", user.role);
      checkLogin();
    })
    .catch(err => {
      console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:", err);
      document.getElementById("error-message").innerText = "ë¡œê·¸ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
    });
}


    // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
    function logout() {
      localStorage.removeItem("username");
      checkLogin();
    }

    /**
 * ë‚´ìš© ì…€ ìˆ˜ì • í›„ í˜¸ì¶œë©ë‹ˆë‹¤.
 * @param {string} id    - Firestore ë¬¸ì„œ ID
 * @param {string} text  - ì…ë ¥ëœ ë‚´ìš©
 */
function onContentChange(id, text) {
  // ë‚´ìš©ì´ ë¹„ì–´ìˆìœ¼ë©´ ì•„ë¬´ ê²ƒë„ ì•ˆ í•¨
  if (!text.trim()) return;

  const now = new Date();
  // YYYY-MM-DD í¬ë§·
  const date = [
    now.getFullYear(),
    String(now.getMonth() + 1).padStart(2, '0'),
    String(now.getDate()).padStart(2, '0')
  ].join('-');
  // HH:MM:SS í¬ë§·
  const time = [
    String(now.getHours()).padStart(2, '0'),
    String(now.getMinutes()).padStart(2, '0'),
    String(now.getSeconds()).padStart(2, '0')
  ].join(':');

  // Firestoreì— í•œêº¼ë²ˆì— ì—…ë°ì´íŠ¸
  tableRef.doc(id).update({
    content: text,
    date: date,
    time: time
  }).then(() => {
    loadTable();  // UI ìƒˆë¡œê³ ì¹¨
  });
}

function showAlarmPopup(message) {
  const popup = document.getElementById("alarmPopup");
  const textEl = popup.querySelector(".alarm-text");
  if (textEl) textEl.innerHTML = message.replace(/\n/g, "<br>");
  popup.style.display = "block";
}


function hideAlarmPopup() {
  document.getElementById("alarmPopup").style.display = "none";
}

function acknowledgeAlarm() {
  const username = localStorage.getItem("username");
  if (!username) return;

  const now = Date.now();
  localStorage.setItem(`alarmAcknowledged_${username}`, now.toString());

  hideAlarmPopup();
  stopLoopingBeep();
  if (audioCtx && audioCtx.state === "suspended") {
    audioCtx.resume();
  }
}



	  

    // ì•ŒëŒ ì‹œì‘ í•¨ìˆ˜
    function sendAlarm() {
      alarmRef.set({isAlarmActive: true}).then(() => {
        console.log("ì•ŒëŒì´ ìš¸ë ¸ìŠµë‹ˆë‹¤.");
      });
    }

    // ì•ŒëŒ ì •ì§€ í•¨ìˆ˜
    function stopAlarm() {
      alarmRef.set({isAlarmActive: false}).then(() => {
        console.log("ì•ŒëŒì´ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
      });
    }

// ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
function loadTable() {
      const dateCounts = {}; // ì´ ì¤„ì„ loadTable() í•¨ìˆ˜ ë§¨ ìœ„ì— ì¶”ê°€
      const currentUser = localStorage.getItem("username"); // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì
      const currentUserUpper = (currentUser || "").toUpperCase();
      const normalizedCurrentUser = ["SBS", "SBS_NQC", "SBS_ING"].includes(currentUser) ? "SBS" : currentUser;
      const receivers = ["KBS", "MBC", "SBS", "MBN", "YTN", "OBS"];

	tableRef
    	.orderBy('createdAt','desc')   // ìƒì„±ëœ ìˆœì„œ(ì˜¤ë˜ëœ ê²ƒë¶€í„°)ë¡œ ì •ë ¬
  	  .get()
  	  .then(snapshot => {
	const docs = snapshot.docs.filter(doc => !doc.data().hidden); // hiddenì´ trueì¸ ë¬¸ì„œ ì œì™¸
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = ""; // í…Œì´ë¸” ì´ˆê¸°í™”

	     const userPermissions = {
	    SBS: { canDelete: false },
	    SBS_NQC: { canDelete: false },
	    SBS_ING: { canDelete: false },
	    // ...ë‹¤ë¥¸ ê³„ì • ê¶Œí•œ ì •ì˜...
	  };
	  const permissions = userPermissions[currentUser] || { canRegister: true, canDelete: true };

    const total = docs.length;  // âœ… ìˆ˜ì •: ì „ì²´ ë¬¸ì„œ ìˆ˜ê°€ ì•„ë‹Œ í•„í„°ë§ëœ ë¬¸ì„œ ìˆ˜ë¡œ
    docs.forEach((doc, index) => {
      const data = doc.data();
      const rowId = doc.id;

          const tr = document.createElement("tr");
          tr.setAttribute("data-row-id", rowId);  // í–‰ IDë¥¼ data-row-idë¡œ ì„¤ì •

	// âœ… ìƒíƒœì— ë”°ë¼ ë°°ê²½ìƒ‰ ì§€ì •
	const status = data.broadcastStatus || "ì†¡ì¶œì „";
	let bgColor = "#fffbe6"; // ê¸°ë³¸ ì†¡ì¶œì „
	if (status === "ì†¡ì¶œì¤‘") bgColor = "#ffcccc";
	else if (status === "ì†¡ì¶œí›„") bgColor = "#dcdcdc";
	tr.style.backgroundColor = bgColor;


          // ìˆ˜ì‹ ì‚¬ë³„ë¡œ ì œì™¸ ìƒíƒœë¥¼ ì²´í¬í•˜ì—¬, í•´ë‹¹ ìˆ˜ì‹ ì‚¬ì—ì„œ ì œì™¸ëœ í–‰ë§Œ ìˆ¨ê¹€
        //  let shouldDisplayRow = true;

        //  receivers.forEach((name, idx) => {
            // ë¡œê·¸ì¸ëœ ê³„ì •ì´ í•´ë‹¹ ìˆ˜ì‹ ì‚¬ì¼ ê²½ìš°, ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ ë¹„êµ
         //   if (currentUser.toUpperCase() === name.toUpperCase() && data[name] && data[name].exclude === "ì œì™¸") {
        //      shouldDisplayRow = false;  // í•´ë‹¹ ìˆ˜ì‹ ì‚¬ì—ì„œ ì œì™¸ëœ ê²½ìš° í•´ë‹¹ í–‰ì„ ìˆ¨ê¸°ë„ë¡ ì„¤ì •
       //     }
        //  });

          // í–‰ì„ ìˆ¨ê¸°ì§€ ì•Šë„ë¡ ì„¤ì •
      //    if (!shouldDisplayRow) {
       //     tr.style.display = "none";  // í•´ë‹¹ ìˆ˜ì‹ ì‚¬ì—ì„œ ì œì™¸ëœ ê²½ìš° í•´ë‹¹ í–‰ì„ ìˆ¨ê¹€
      //    }

          tr.innerHTML = `
  	  <td>${total - index}</td>
	  <td>${data.date || ''}</td>
	  <td>${data.time || ''}</td>
	  <td>${data.sender || ''}</td>
	  <td>${data.content || ''}</td>

  ${receivers.map(rcv => {
    const ackText = (data[rcv] && data[rcv].ack) || 'ë¯¸í™•ì¸';
    const excludeText = (data[rcv] && data[rcv].exclude) || 'í¬í•¨';

    const ackClass = ackText === 'í™•ì¸ì™„ë£Œ' ? 'ack-confirmed' : 'ack-pending';
    // ë³¸ì¸ ê³„ì • ìˆ˜ì‹ ì‚¬ì´ë©´ì„œ ë¯¸í™•ì¸ ìƒíƒœì¼ ë•Œë§Œ ê¹œë¹¡ì„ ì ìš©
   const blinkClass = (ackText !== 'í™•ì¸ì™„ë£Œ' && rcv === normalizedCurrentUser) ? 'blink' : '';

    return `
      <td>
     	 <span class="ack-text ${ackClass} ${blinkClass}">${ackText}</span>
      </td>
      <td>
         <span class="exclude-text">${excludeText}</span>
      </td>
    `;
  }).join('')}
  <td>
   <button onclick="deleteRowById('${doc.id}')" ${permissions.canDelete ? '' : 'disabled style="opacity:0.5;cursor:not-allowed"'}>í–‰ ì‚­ì œ</button>
  </td>

          `;
          tbody.appendChild(tr);
          // â­ ë‚ ì§œë³„ ê±´ìˆ˜ ì„¸ê¸°
          if (data.date) {
            if (dateCounts[data.date]) {
              dateCounts[data.date]++;
            } else {
              dateCounts[data.date] = 1;
            }
          }

        index++;  // âœ… ì¹´ìš´í„° ì¦ê°€
        });
		// ê³ ì •ëœ ì²« í–‰ ì¶”ê°€
		const fixedRow = document.createElement("tr");
		fixedRow.innerHTML = `
		  <td>ê³ ì •</td>
		  <td>2025-xx-xx</td>
		  <td>00:00:00</td>
    		  <td>LGU+</td>
		  <td>ğŸ›  ë‚´ìš© ë“±ë¡ ë°•ìŠ¤ë¥¼ ì…ë ¥í•˜ì‹œê³  ë“±ë¡ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.(ì²« í–‰ì€ ê³ ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.)</td>
		  <td colspan="13" style="color:blue;">ìˆ˜ì‹ ì‚¬ì—ì„œëŠ” ë‚´ìš© í™•ì¸ ì‹œ í™•ì¸ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. / ìˆ˜ì‹ ë²„íŠ¼ì€ ì œì™¸í•  íƒ€ ë°©ì†¡ì‚¬ë§Œ ëˆŒëŸ¬ì£¼ì„¸ìš”.</td>
		`;
    		tbody.appendChild(fixedRow);

		// ì—¬ê¸° ì¶”ê°€
		applyExcludeStyles();
      });
    }

function applyExcludeStyles() {
  document.querySelectorAll('.exclude-text').forEach(el => {
    const text = el.textContent.trim();
    el.classList.remove('exclude-include', 'exclude-exclude'); // ê¸°ì¡´ í´ë˜ìŠ¤ ì´ˆê¸°í™”

    if (text === 'í¬í•¨') {
      el.classList.add('exclude-include');
    } else if (text === 'ì œì™¸') {
      el.classList.add('exclude-exclude');
    }
  });
}
	  
	  
 	function toggleView() {
	  const btn = document.getElementById("toggleViewButton");
	
	  if (isShowingAll) {
	    // ê¸°ë³¸ ë³´ê¸°ë¡œ ì „í™˜
	    loadTable();
	    btn.innerText = "ğŸ“‹ ê¸°ë³¸ ë³´ê¸°";
	    isShowingAll = false;
	  } else {
	    // ì „ì²´ ë³´ê¸°ë¡œ ì „í™˜
	    openAllRows();
	    btn.innerText = "ğŸ“„ ì „ì²´ ë³´ê¸°";
	    isShowingAll = true;
	  }
	}

    // ì…€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateCell(id, field, value) {
      tableRef.doc(id).update({[field]: value}).then(() => loadTable());
    }

    // í™•ì¸ ìƒíƒœ í† ê¸€
    function toggleAck(id, rcv) {
      const cellRef = tableRef.doc(id);
      cellRef.get().then(doc => {
        const data = doc.data();
        const current = (data[rcv] && data[rcv].ack) || 'ë¯¸í™•ì¸';
        const updated = current === 'ë¯¸í™•ì¸' ? 'í™•ì¸ì™„ë£Œ' : 'ë¯¸í™•ì¸';
        cellRef.update({[`${rcv}.ack`]: updated}).then(() => {
          loadTable();
        });
      });
    }


    // í–‰ ì¶”ê°€ í•¨ìˆ˜
    function addRow() {
      const rowData = {
        date: '', time: '', content: '', sender: '',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
	hidden: false,  // âœ… ìˆ¨ê¹€ ì—¬ë¶€
  	broadcastStatus: "ì†¡ì¶œì „",  // âœ… ë²„íŠ¼ ìƒíƒœ ê¸°ë³¸ê°’
      };

      const receivers = ["KBS", "MBC", "SBS", "MBN", "YTN", "OBS"];
      receivers.forEach(rcv => {
        rowData[rcv] = {ack: 'ë¯¸í™•ì¸', exclude: 'ì œì™¸'};
      });
      tableRef.add(rowData).then(() => {
        loadTable();
      });
    }

    function saveData() {
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }

function openContentPopup() {
  document.getElementById("contentPopup").style.display = "block";
}

function closeContentPopup() {
  document.getElementById("contentPopup").style.display = "none";
}


function registerContent() {
  const content = document.getElementById("inputContent").value.trim();
  const sender = document.getElementById("inputSender").value;
  const checkboxes = document.querySelectorAll("input[type='checkbox']:checked");

  if (!content || !sender) {
    alert("ë‚´ìš©ê³¼ ì†¡ì¶œì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  // í˜„ì¬ ë‚ ì§œ ë° ì‹œê°„ ê³„ì‚°
  const now = new Date();
  const date = [
    now.getFullYear(),
    String(now.getMonth() + 1).padStart(2, '0'),
    String(now.getDate()).padStart(2, '0')
  ].join('-');
  const time = [
    String(now.getHours()).padStart(2, '0'),
    String(now.getMinutes()).padStart(2, '0'),
    String(now.getSeconds()).padStart(2, '0')
  ].join(':');

  const rowData = {
    date: date,
    time: time,
    content: content,
    sender: sender,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    hidden: false,
    broadcastStatus: "ì†¡ì¶œì „"
  };
	
  const currentUser = localStorage.getItem("username")?.toUpperCase();  // ë¡œê·¸ì¸í•œ ê³„ì •
  const receivers = ["KBS", "MBC", "SBS", "MBN", "YTN", "OBS"];
  receivers.forEach(rcv => {
  const isSender = rcv === sender;                 // select boxë¡œ ì„ íƒí•œ ì†¡ì¶œì‚¬
  const isCurrentUser = rcv === currentUser;       // í˜„ì¬ ë¡œê·¸ì¸í•œ ê³„ì •
  const isIncludedChecked = [...checkboxes].some(cb => cb.value === rcv);


// ì†¡ì¶œì‚¬ ë˜ëŠ” ë¡œê·¸ì¸ ê³„ì •ì€ í•­ìƒ í¬í•¨
const isIncluded = isSender || isCurrentUser || isIncludedChecked;

  rowData[rcv] = {
    ack: "ë¯¸í™•ì¸",
    exclude: isIncluded ? "í¬í•¨" : "ì œì™¸"
  };
  });

tableRef.add(rowData).then((docRef) => {
        const docId = docRef.id;  // ìƒˆë¡œ ìƒì„±ëœ ë¬¸ì„œ ID ì–»ê¸°
	const popupId = `alarm_${Date.now()}`;  // ê³ ìœ  íŒì—… ID ìƒì„±
	const popupMessage = `ğŸ“¡ 6ì‚¬ë³´ë„ ìë£Œì†¡ì¶œì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!
	ğŸ“‘ ë‚´ìš©: ${content}
	ğŸ“¤ ì†¡ì¶œì‚¬: ${sender}`;
	
createAlarmPopup(popupMessage, popupId, docId);
	
   alarmRef.set({
    isAlarmActive: true,
    alarmMessage: popupMessage,
    timestamp: Date.now()
  });

  loadTable();
  document.getElementById("inputContent").value = "";
});

}


function deleteRowById(id) {
  if (confirm("ì •ë§ ì´ í–‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    tableRef.doc(id).delete().then(() => {
      alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
      location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    }).catch(error => {
      console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
      alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    });
  }
}
	  	  

    // í–‰ ì‚­ì œ í•¨ìˆ˜
function deleteRow() {
  const checkedBoxes = document.querySelectorAll("#logTable tbody input[type='checkbox']:checked");
  const deletePromises = [];

  checkedBoxes.forEach(box => {
    const id = box.getAttribute("data-id");
    const row = box.closest("tr");
    const isFixedRow = row && row.innerText.includes("ğŸ›  ë‚´ìš© ë“±ë¡ ë°•ìŠ¤ë¥¼ ì…ë ¥í•˜ì‹œê³  ë“±ë¡ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.(ì²« í–‰ì€ ê³ ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.)");

    if (!isFixedRow && id) {
      deletePromises.push(tableRef.doc(id).delete());
    }
  });

  Promise.all(deletePromises).then(() => {
    loadTable();
  });
}


    // í˜ì´ì§€ ë¡œë”© ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    document.addEventListener("DOMContentLoaded", checkLogin);

document.addEventListener("DOMContentLoaded", function () {
  const refreshButton = document.getElementById("refreshButton");
  if (refreshButton) {
    refreshButton.addEventListener("click", function () {
      window.location.reload(); // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
    });
  }


  // âœ… ì ‘ì† ì§í›„ë¶€í„° 1ë¶„ ê°„ê²© ìë™ ìƒˆë¡œê³ ì¹¨
  setInterval(function () {
    window.location.reload();
  }, 60000); // 60000ms = 1ë¶„
});

  </script>
  <style>

    h1 {
      text-align: center;
    }

    .button-container {
      text-align: center;
      margin-bottom: 20px;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .send,
    .stop,
    .add,
    .delete,
    .save,
    .refresh,
    .logout {
      background-color: #2196F3;
      color: white;
    }

    .send {
      background-color: #FF9800;
    }

    .stop {
      background-color: #f44336;
    }

    .add,
    .delete,
    .save {
      background-color: #4CAF50;
    }

    .exclude-btn.active {
      background-color: #f44336;
      color: white;
    }

    .exclude-btn {
      background-color: #2196F3;
      color: white;
    }

    /* ëª¨ë“  í…Œì´ë¸” ë²„íŠ¼ í¬ê¸° ì¶•ì†Œ */
#logTable td button {
  padding: 6px 12px;
  font-size: 1rem;
  line-height: 1.4;
  min-width: 0;          /* ìµœì†Œ ë„ˆë¹„ ì œí•œ í•´ì œ */
}

/* 1~4ì—´ í—¤ë”ë§Œ ê¸€ì í¬ê¸° ë° êµµê¸° í‚¤ìš°ê¸° */
#logTable th:nth-child(-n+4) {
  font-size: 1.4rem;
}

#logTable th[colspan="12"] {
  font-size: 1.4rem;
}  
	  
    /* â€˜ë‚´ìš©â€™ ì…ë ¥ ì¹¼ëŸ¼(í…Œì´ë¸” 5ë²ˆì§¸ ì¹¼ëŸ¼) ê¸€ì í¬ê²Œ */
#logTable td:nth-child(5),
#logTable th:nth-child(5) {
  font-size: 1.4rem;    /* ì›í•˜ì‹œëŠ” í¬ê¸°ë¡œ ì¡°ì •í•˜ì„¸ìš” */
  line-height: 1.4;     /* í•„ìš”ì‹œ ì¤„ê°„ê²©ë„ ì¡°ì ˆ */
}

    .logout {
      background-color: #9C27B0;
    }

    .login-container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .login-container input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .login-container button {
      width: 100%;
      padding: 12px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .login-container button:hover {
      background-color: #1976D2;
    }

    .error-message {
      color: red;
      margin-top: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: center;
    }

    thead th {
      background-color: #f2f2f2;
      font-weight: bold;
    }


    td[contenteditable] {
      border: 1px solid #ccc;
    }

    .receiver-row {
      text-align: center;
      font-weight: bold;
      background-color: #f2f2f2;
    }
  </style>
 <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
   <div id="login-container" class="login-container" style="display: none;">
    <h2>ğŸ“¡ 6ì‚¬ë³´ë„ë§ ë¡œê·¸ì¸</h2>
    <input type="text" id="username" placeholder="ì•„ì´ë””" required />
    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
    <button onclick="login()">ë¡œê·¸ì¸</button>
    <div class="error-message" id="error-message"></div> <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ -->
  </div>

<style>
  /* ìˆ˜ì‹ ì‚¬ ë¡œê³  ê´€ë ¨ ìŠ¤íƒ€ì¼ */

  /* ğŸ”½ ì—¬ê¸° ì•„ë˜ì— ì¶”ê°€ */
  input[type="text"], select {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ffb6c1;
    border-radius: 6px;
    font-size: 16px;
    background-color: #fffafd;
    box-sizing: border-box;
  }

  input[type="text"]:focus,
  select:focus {
    outline: none;
    border-color: #ff69b4;
    box-shadow: 0 0 6px rgba(255, 105, 180, 0.5);
  }

  input[type="checkbox"] {
    accent-color: #ff69b4;
    transform: scale(1.2);
    margin-right: 4px;
  }
</style>

	

  <style>

	/* í˜ì´ì§€ ì „ë°˜ ë°°ê²½ì„ ì˜…ì€ ë¶„í™ìƒ‰ìœ¼ë¡œ ì„¤ì • */
	body {
	  font-family: Arial, sans-serif;
	  padding: 20px;
	  background-color: #ffe6f0;
	}
	
	/* ì‘ì„± í˜ì´ì§€ í­ì„ í™”ë©´ ì „ì²´ë¡œ ìœ ì§€ */
	.login-container,
	#service-container {
	  width: calc(100% - 40px); /* body padding 20pxì”© ì œì™¸ */
	  margin: 0 auto;
	  background: #fff;
	  padding: 20px;
	  border-radius: 8px;
	}

	.danger-button {
	  color: red;
	  font-weight: bold;
	}
    
    /* ë¡œê·¸ì¸ ë°•ìŠ¤ ë””ìì¸ */
    .login-container {
      max-width: 400px;
      padding: 30px;
      background-color: rgba(0, 0, 0, 0.6);
      /* ë°˜íˆ¬ëª… ê²€ì •ìƒ‰ ë°°ê²½ */
      border-radius: 10px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
      text-align: center;
      color: white;
    }

	/* ğŸ”’ ì œëª©, ë²„íŠ¼ ê³ ì • */
	.header-fixed {
	  position: sticky;
	  top: 0;
	  background-color: #ffffff;
	  z-index: 1000;
	  padding-top: 10px;
	  padding-bottom: 10px;
	}
	
	/* ğŸ”’ í…Œì´ë¸” í—¤ë” ê³ ì •ìš© ë˜í¼ */
	.table-wrapper {
	  max-height: 900px;  /* í•„ìš” ì‹œ ì¡°ì ˆ ê°€ëŠ¥ */
	  overflow-y: auto;
	  background-color: #ffffff; 
	}
	
	/* ğŸ”’ í…Œì´ë¸” í—¤ë”(2ì¤„) ê³ ì • */
	#logTable thead tr:nth-child(1),
	#logTable thead tr:nth-child(2) {
	  position: sticky;
	  top: 0;
	  background-color: white;
	  z-index: 10;
	}

	  
    /* íƒ€ì´í‹€ ë””ìì¸ */
    .login-container h2 {
      color: #FF9800;
      /* ë°©ì†¡ ì‹œìŠ¤í…œ ìƒ‰ìƒ, ì£¼í™©ìƒ‰ */
      font-size: 24px;
      margin-bottom: 20px;
    }

    /* ì¸í’‹ ë°•ìŠ¤ ë””ìì¸ */
    .login-container input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #FF9800;
      /* ì…ë ¥ë€ í…Œë‘ë¦¬ ìƒ‰ìƒ ì£¼í™©ìƒ‰ */
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      background-color: #333;
      /* ì…ë ¥ë€ ë°°ê²½ ì–´ë‘ìš´ ìƒ‰ */
      color: white;
    }

    .deleteAll {
  	background-color: #e91e63; /* ì§„í•œ í•‘í¬ */
	  color: white;
     }
	  
	#logTable select {
	  font-size: 16px;  /* ë²„íŠ¼ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì • */
  	  padding: 6px 12px;  /* ë²„íŠ¼ê³¼ ì—¬ë°±ë„ ë§ì¶°ì£¼ë©´ ë³´ê¸° ì¢‹ìŒ */
	  font-weight: bold;   /* êµµê¸°ê¹Œì§€ ë§ì¶”ê¸° */
	  line-height: 1.4;
	}

.footer-button-container {
  text-align: center;
  margin-top: 30px;
  padding: 20px 0;
  border-top: 2px solid #ccc;
}

.footer-button-container button {
  padding: 12px 24px;
  margin: 5px;
  font-size: 16px;
  font-weight: bold;
  background-color: #607d8b;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.footer-button-container button:hover {
  background-color: #455a64;
}

    .footer-comment {
      margin-top: 15px;
      text-align: center;
      color: red;
      font-weight: bold;
      font-size: 16px;
     }

/* í™•ì¸ ìƒíƒœ í…ìŠ¤íŠ¸ ë„¤ëª¨ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
.ack-text {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 4px;
  font-weight: bold;
  border: 1px solid black;
  user-select: none;
  cursor: default;
  color: black !important;
}

/* ë¯¸í™•ì¸ - ë…¸ë€ìƒ‰ ë°°ê²½, ê²€ì • ê¸€ì”¨ */
.ack-pending {
  background-color: #ffb74d; /* ë°ì€ ì£¼í™©ìƒ‰ */
  color: black !important;
  border-color: #ff9800; /* ê¸°ì¡´ ì£¼í™© í…Œë‘ë¦¬ */
}

/* í™•ì¸ì™„ë£Œ - ì´ˆë¡ìƒ‰ ë°°ê²½, í°ìƒ‰ ê¸€ì”¨ */
.ack-confirmed {
  background-color: #4caf50;
  color: white !important;
  border-color: #388e3c;
}

/* í¬í•¨/ì œì™¸ í…ìŠ¤íŠ¸ ë„¤ëª¨ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
.exclude-text {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 4px;
  font-weight: bold;
  user-select: none;
  border: 1px solid black;
  color: black !important;
  cursor: default;
  margin-top: 4px;
}

/* í¬í•¨ */
.exclude-include {
  background-color: #bbdefb; /* ì—°í•œ íŒŒë€ìƒ‰ */
  border-color: #64b5f6;
  color: black !important;
}

/* ì œì™¸ */
.exclude-exclude {
  background-color: #ffcdd2; /* ì—°í•œ ë¹¨ê°•ìƒ‰ */
  border-color: #e57373;
  color: black !important;
}

/* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

/* ê¹œë¹¡ì„ íš¨ê³¼ í´ë˜ìŠ¤ */
.blink {
  animation: blink 1.2s infinite;
}


    /* ë¡œê·¸ì¸ ë²„íŠ¼ ë””ìì¸ */
    .login-container button {
      width: 100%;
      padding: 12px;
      background-color: #FF9800;
      /* ë²„íŠ¼ ìƒ‰ìƒ ì£¼í™©ìƒ‰ */
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }

    /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
    .login-container button:hover {
      background-color: #FF5722;
      /* ë²„íŠ¼ í˜¸ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ (ì–´ë‘ìš´ ì£¼í™©ìƒ‰) */
    }

    /* ì˜¤ë¥˜ ë©”ì‹œì§€ ë””ìì¸ */
    .error-message {
      color: red;
      margin-top: 10px;
    }
  </style>

  <div id="dateCounts" style="margin-top: 20px;"></div>
  
  <!-- ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ í˜ì´ì§€ -->
     <div id="service-container" style="display: none;">

	<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
	  <button onclick="openContentPopup()" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 6px; font-weight: bold;">
	    ğŸ“¥ ë‚´ìš© ë“±ë¡
	  </button>
	  <div style="display: flex; align-items: center; gap: 10px;">
	    <button id="refreshButton" style="padding: 6px 12px; background-color: #607d8b; color: white; border-radius: 6px; border: none; cursor: pointer;">ğŸ”ƒ ìƒˆë¡œê³ ì¹¨</button>
	    <span id="currentUser" style="background: #f1f1f1; padding: 6px 12px; border-radius: 20px; font-weight: bold;"></span>
	    <button onclick="logout()" style="padding: 6px 12px; border: none; background-color: #607d8b; color: white; border-radius: 8px;">ë¡œê·¸ì•„ì›ƒ</button>
	  </div>
	</div>

	  
<h1 class="header-fixed" style="font-size: 28px;">ğŸ“¡ 6ì‚¬ë³´ë„ ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤</h1>
	  
<!-- âœ… ê¸°ì¡´ ë‚´ìš© ë“±ë¡ ë°•ìŠ¤ ì œê±° ë˜ëŠ” ì£¼ì„ì²˜ë¦¬ -->
<!--	  
<div style="
  max-width: 500px;
  margin: 30px auto;
  padding: 30px 20px;
  background: linear-gradient(to bottom right, #fff5f7, #ffeef1);
  border: 2px solid #ffb6c1;
  border-radius: 16px;
  box-shadow: 0 8px 16px rgba(255, 182, 193, 0.3);
  text-align: center;
">

	  <h2 style="margin-bottom: 20px;">ë‚´ìš© ë“±ë¡</h2>
	  <input id="inputContent" type="text" placeholder="ë‚´ìš© ì…ë ¥" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc;" />
	  <select id="inputSender" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px;">
	    <option value="SBS">SBS</option>
	    <option value="KBS">KBS</option>
	    <option value="MBC">MBC</option>
	    <option value="MBN">MBN</option>
	    <option value="YTN">YTN</option>
	    <option value="OBS">OBS</option>
	    <option value="LGU+">LGU+</option>
	  </select>
	
	  <div style="margin-bottom: 15px;">
	    <p style="margin-bottom: 6px;">ì´ ë‚´ìš©ì—ì„œ ì œì™¸í•  ìˆ˜ì‹ ì‚¬ ì„ íƒ</p>
	    <label><input type="checkbox" value="KBS" /> KBS</label>
	    <label><input type="checkbox" value="MBC" /> MBC</label>
	    <label><input type="checkbox" value="SBS" /> SBS</label>
	    <label><input type="checkbox" value="MBN" /> MBN</label>
	    <label><input type="checkbox" value="YTN" /> YTN</label>
	    <label><input type="checkbox" value="OBS" /> OBS</label>
	  </div>
	
	  <button onclick="registerContent()" style="width: 100%; padding: 12px; background-color: #4CAF50; color: white; border: none; border-radius: 6px; font-weight: bold;">ë“±ë¡</button>
	</div>
	     -->

  <!--  <p id="currentUser" style="font-size: 18px; color: #333;">ë¡œê·¸ì¸ëœ ì‚¬ìš©ì: </p> ë¡œê·¸ì¸í•œ ì‚¬ìš©ì í‘œì‹œ -->


  <div class="button-container header-fixed">
    <!--  <button class="add" onclick="addRow()">â• í–‰ ì¶”ê°€</button> -->
    <!--  <button class="delete" onclick="deleteRow()">ğŸ—‘ í–‰ ì‚­ì œ</button> -->
    <!--      <button class="save" onclick="saveData()">ğŸ’¾ ì €ì¥</button> -->
    <!--   <button class="logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button> -->
    </div>


<div class="table-wrapper">
    <table id="logTable">
      <thead>
        <tr>
	  <th rowspan="2">ë²ˆí˜¸</th>
	<!--  <th rowspan="2">ì†¡ì¶œêµ¬ë¶„</th>   âœ… ì—¬ê¸° ì¶”ê°€ -->
          <th rowspan="2">ë‚ ì§œ</th>
          <th rowspan="2">ì˜¬ë¦°ì‹œê°„</th>
	  <th rowspan="2">ì†¡ì¶œì‚¬</th>
          <th rowspan="2">ë‚´ìš©</th>
          <th colspan="12">ìˆ˜ì‹ ì‚¬</th>
	  <th rowspan="2">ìƒíƒœ/ê´€ë¦¬</th>
        </tr>
<tr>
<th colspan="2"><img src="/static/KBS.png" class="logo-img" alt="KBS"></th>
<th colspan="2"><img src="/static/MBC.png" class="logo-img" alt="MBC"></th>
<th colspan="2"><img src="/static/SBS.png" class="logo-img" alt="SBS"></th>
<th colspan="2"><img src="/static/MBN.png" class="logo-img" alt="MBN"></th>
<th colspan="2"><img src="/static/YTN.png" class="logo-img" alt="YTN"></th>
<th colspan="2"><img src="/static/OBS.png" class="logo-img" alt="OBS"></th>
</tr>

      </thead>
      <tbody id="tableBody"></tbody>
    </table>
</div>
    <div class="footer-button-container">
    <button id="alarmToggleButton" class="send" onclick="toggleAlarm()">ğŸ””ìë£Œì†¡ì¶œ ì•Œë¦¼</button>
    <button onclick="stopAlarm()" class="stop">ğŸ›‘ ì „ì²´ ì•ŒëŒ ì •ì§€</button>
  <!--  <button id="refreshButton" class="refresh">ğŸ”ƒì›¹í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button> -->
    <button onclick="openAllView()">ğŸ§¾ì†¡ì¶œ ì´ë ¥ ë³´ê¸°</button>
  <!--  <button id="toggleViewButton" onclick="toggleView()">ğŸ“‹ ê¸°ë³¸ ë³´ê¸°</button> -->
    <button onclick="downloadAsExcel()">ğŸ“Š ì—‘ì…€ë¡œ ì €ì¥</button>
    <button id="backupButton" class="deleteAll" onclick="deleteAllhides()">ğŸ“‹ìë£Œì†¡ì¶œ ë‚´ì—­ ë°±ì—…</button>
  <!-- <button class="danger-button" onclick="deleteAllRows()">âŒ ì „ì²´ í–‰ ì™„ì „ ì‚­ì œ</button> -->
    </div>

  </div>
	
<div id="alarmPopup" style="
  display: none;
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 0 12px rgba(0,0,0,0.3);
  text-align: center;
  z-index: 9999;
">
  <p class="alarm-text" style="font-size: 18px; font-weight: bold;">ğŸ”” ìë£Œ ì†¡ì¶œ ì•Œë¦¼ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤!</p>
  <p>í™•ì¸ì„ ëˆ„ë¥´ë©´ ì´ ê³„ì •ì—ì„œë§Œ ì•Œë¦¼ì´ ì •ì§€ë©ë‹ˆë‹¤.</p>
  <button onclick="acknowledgeAlarm()" style="margin-top: 20px; padding: 10px 20px; font-size: 16px;">âœ… í™•ì¸</button>
</div>

<!-- ì•ŒëŒ íŒì—… ì»¨í…Œì´ë„ˆ -->
<div id="alarmPopupContainer" style="
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 9999;
  max-width: 400px;
  width: 90%;
">
  <!-- íŒì—…ì´ ì—¬ê¸°ì— ì—¬ëŸ¬ ê°œ ë™ì  ìƒì„±ë¨ -->
</div>


<!-- ë‚´ìš© ë“±ë¡ íŒì—… -->
<div id="contentPopup" style="display: none; position: fixed; top: 50px; left: 30px; width: 400px; background: #fff; border: 2px solid #4CAF50; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 9999;">
  <h3 style="margin-top: 0; color: #4CAF50;">ğŸ“ ë‚´ìš© ë“±ë¡</h3>
  <input id="inputContent" type="text" placeholder="ë‚´ìš© ì…ë ¥" style="width: 100%; margin-bottom: 10px;" />
  <select id="inputSender" style="width: 100%; margin-bottom: 10px;">
    <option value="SBS">SBS</option>
    <option value="KBS">KBS</option>
    <option value="MBC">MBC</option>
    <option value="MBN">MBN</option>
    <option value="YTN">YTN</option>
    <option value="OBS">OBS</option>
    <option value="LGU+">LGU+</option>
  </select>
  <div style="margin-bottom: 10px;">
    <p style="margin-bottom: 4px;">í¬í•¨ ìˆ˜ì‹ ì‚¬ ì„ íƒ</p>
  <label><input type="checkbox" value="KBS" checked /> KBS</label>
  <label><input type="checkbox" value="MBC" checked /> MBC</label>
  <label><input type="checkbox" value="SBS" checked /> SBS</label>
  <label><input type="checkbox" value="MBN" checked /> MBN</label>
  <label><input type="checkbox" value="YTN" checked /> YTN</label>
  <label><input type="checkbox" value="OBS" checked /> OBS</label>
  </div>
  <div style="text-align: right;">
    <button onclick="registerContent()" style="background-color: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 6px;">ë“±ë¡</button>
    <button onclick="closeContentPopup()" style="margin-left: 6px; background-color: #ccc; color: black; border: none; padding: 8px 16px; border-radius: 6px;">ë‹«ê¸°</button>
  </div>
</div>

	
  <style>

    #logTable {
	  width: 100%;
	  border-collapse: collapse;
	  margin-top: 20px;
	  background-color: #ffffff; 
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: center;
    }

    thead th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
	  
	tbody tr {
	  background-color: inherit;
	}

    td[contenteditable] {
      border: 1px solid #ccc;
    }
  </style>

<!-- âœ… ìƒˆë¡­ê²Œ ë‹«íŒ í›„ ì—¬ê¸°ì— ìŠ¤íƒ€ì¼ ì¶”ê°€ -->
<style>
.logo-KBS {
  font-weight: bold;
  color: #00338D;
  font-size: 1.1rem;
  font-family: "Arial Black", sans-serif;
  letter-spacing: 1px;
}
.logo-MBC {
  font-weight: bold;
  color: #1c1c1c;
  font-size: 1.1rem;
  font-family: "Verdana", sans-serif;
}
.logo-SBS {
  font-weight: bold;
  color: #0a84ae;
  font-size: 1.1rem;
  font-family: "Tahoma", sans-serif;
}
.logo-MBN {
  font-weight: bold;
  color: #f37021;
}
.logo-YTN {
  font-weight: bold;
  color: #0066cc;
}
.logo-OBS {
  font-weight: bold;
  color: #4caf50;
}
</style>
	
<style>
.logo-img {
  width: 60px;
  height: 24px;
  object-fit: contain;     /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì´ë¯¸ì§€ ì „ì²´ ë³´ì´ê¸° */
  display: block;
  margin: auto;
  background-color: #f0f0f0; /* ì´ë¯¸ì§€ ê¹¨ì¡Œì„ ë•Œ ë°°ê²½ ì²˜ë¦¬ */
}
</style>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>
